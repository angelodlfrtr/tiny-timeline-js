(function(){"use strict";var Timeline=function(element,duration,opts){if(opts===undefined){opts={}}this.duration=duration;this.opts=opts;this.element=element;this.lines={};this.state=null;this.timestamp=0;this.interval=null;this.createCursor()};Timeline.prototype.addLine=function(name,opts){var self=this;if(opts==undefined){opts={}}opts["events"]={};var l=this.lines[name]=opts;this.appendLine(l);l.addEvent=function(name,opts){opts.onActive=function(callback){setInterval(function(){if(self.timestamp>=opts["start"]&&self.timestamp<=opts["end"]){callback(l.events[name])}},5)};l.events[name]=opts;self.appendEvent(l,name,opts);return l.events[name]};return l};Timeline.getLine=function(name){return this.lines[name]};Timeline.prototype.goTo=function(timestamp){var percent=timestamp*100/this.duration;this.setCursorTo(percent);this.timestamp=timestamp;return this.timestamp};Timeline.prototype.setCursorTo=function(percent){var cu=this.timestamp*100/this.duration;var ce=this.getCursorElement();var diff=Math.abs(percent-cu);if(diff>=.5){ce.classList.add("animate")}var px=percent*this.element.clientWidth/100;ce.style["margin-left"]=px+"px";setTimeout(function(){ce.classList.remove("animate")},100)};Timeline.prototype.appendEvent=function(line,event_name,event_opts){var event_element=document.createElement("div");event_element.classList.add("event");var title_element=document.createElement("span");title_element.setAttribute("title",event_name);title_element.innerHTML=event_name;event_element.appendChild(title_element);var bgcolor="red";if(line["color"]){bgcolor=line["color"]}var element_width=(event_opts["end"]-event_opts["start"])*100/this.duration*this.element.clientWidth/100;var element_margin_left=event_opts["start"]*100/this.duration*this.element.clientWidth/100;event_element.style["margin-left"]=element_margin_left+"px";event_element.style.width=element_width+"px";event_element.style["background-color"]=bgcolor;line.element.appendChild(event_element)};Timeline.prototype.appendLine=function(line){var line_element=document.createElement("div");line_element.classList.add("line");this.element.appendChild(line_element);var cursor_element=this.getCursorElement();cursor_element.style.height=this.element.clientHeight+"px";line.element=line_element;return line_element};Timeline.prototype.createCursor=function(){var cursor_element=document.createElement("div");cursor_element.classList.add("cursor");this.element.appendChild(cursor_element)};Timeline.prototype.getCursorElement=function(){return this.element.querySelector(".cursor")};window.Timeline=Timeline}).call(this);var element=document.querySelector("#timeline");var test=new Timeline(element,1e4,{});var line1=test.addLine("Gestes",{color:"#1abc9c"});var line2=test.addLine("Macho",{color:"#3498db"});var line3=test.addLine("OK",{color:"#e74c3c"});var event=line1.addEvent("Cool",{start:1e3,end:3e3,title:"Un super titre"});event.onActive(function(e){document.querySelector("pre").innerHTML="Je passe sur 'Cool'"});line1.addEvent("Oh my !",{start:6e3,end:9e3,title:"Kiki"});line2.addEvent("Pas cool",{start:0,end:2e3,title:"Un titre"});line2.addEvent("Oh my god !",{start:6e3,end:1e4,title:"Kiki"});line3.addEvent("Oh mon dieu !",{start:2e3,end:8e3,title:"Kiki"});var start=0;var i=setInterval(function(){start+=5;test.goTo(start);if(start>=test.duration){clearInterval(i)}});